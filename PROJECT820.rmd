---
title: "CIND820"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages}
##Packages

#install.packages('tidyverse')
#install.packages('dplyr')
#install.packages('car')
#install.packages("DescTools")
#install.packages("arules")
#install.packages("Rtools")
#install.packages("stats")
library(arules)
library(DescTools)
library(dplyr)
library(tidyr)
library(car)
library(stats)

```

```{r read}
cancer_incidence<- read.csv(file="C:/Users/olivi/OneDrive/Documents/DataSets/13100109-eng/13100109.csv", sep = ",")
```

```{r configure}
#first remove columns from cancer incidence frame
##############################################################
cancer_table<- subset(cancer_incidence, select = -c(DGUID,UOM_ID,UOM,SCALAR_FACTOR,SCALAR_ID, VECTOR, COORDINATE, STATUS, SYMBOL, TERMINATED, DECIMALS))

#now remove all rows that contain the characteristic value that we don't want to measure

cancer_cl<-cancer_table[-grep("Statistically different from", cancer_table$Characteristics),]
cancer_cl<- cancer_cl[grep("age-standardized", cancer_cl$Characteristics),]
cancer_cl<-cancer_cl[-grep("95%", cancer_cl$Characteristics),]
#cancer_cl<-cancer_cl[grep("Both", cancer_cl$Sex),]
#cancer_cl<-cancer_cl[grep("All invasive", cancer_cl$Selected.sites.of.cancer..ICD.O.3.),]


#try spread
#remove duplicated elements so spread works
cancer_w<-cancer_cl[!duplicated(cancer_cl),]
cancer_w4<-spread(cancer_w, Characteristics, VALUE)
cancer_w4<- cancer_w4[-grep("Canada", cancer_w4$GEO),]
cancer_w4<- cancer_w4[-grep("Peer", cancer_w4$GEO),]

```

```{r preliminary}
n_distinct(cancer_cl$GEO)
##154

summary(cancer_w4)
str(cancer_w4)

hist(cancer_w4$`Cancer incidence (age-standardized rate per 100,000 population)`)


```

```{r more variables but less obs}
cancer_2<-cancer_table[-grep("Statistically different from", cancer_table$Characteristics),]
cancer_2<-cancer_2[-grep("95%", cancer_2$Characteristics),]
cancer_2<-cancer_2[grep("age-standardized", cancer_2$Characteristics),]
cancer_2<-cancer_2[-grep("Canada", cancer_2$GEO),]
cancer_2<-cancer_2[-grep("Peer", cancer_2$GEO),]
cancer_2<- cancer_2[!duplicated(cancer_2),]


cancer_2.1<- spread(cancer_2, Characteristics, VALUE)

cancer_2.2<- cancer_2.1[,1:5]
cancer_2.2<- spread(cancer_2.2, Selected.sites.of.cancer..ICD.O.3., 'Cancer incidence (age-standardized rate per 100,000 population)')


cancer_2.2<-as.data.frame(unclass(cancer_2.2), stringsAsFactors = TRUE)
#levels(cancer_2.2$GEO)

```

```{r histograms}
hist(cancer_2.2[,4], breaks = 50, main = "All cancer sites")
hist(cancer_2.2[,5], breaks = 50, main = "Bronchus and lung cancer")
hist(cancer_2.2[,6], breaks = 50, main = "Colon cancer")
hist(cancer_2.2[,7], breaks = 50, main = "Female breast cancer")
hist(cancer_2.2[,8], breaks = 25, main = "Prostate cancer")
```

```{r incidence quantiles}

cancer_2.3<- cancer_2.2[,1:3]

cancer_2.3["Quantile_All"]<- CutQ(cancer_2.2[,4], breaks = 6, na.rm=FALSE)
cancer_2.3["Quantile_bronc"]<- CutQ(cancer_2.2[,5], breaks = 6, na.rm=FALSE)
cancer_2.3["Quantile_colon"]<- CutQ(cancer_2.2[,6], breaks = 6, na.rm=FALSE)
cancer_2.3["Quantile_breast"]<- CutQ(cancer_2.2[,7],breaks = 6, na.rm=FALSE)
cancer_2.3["Quantile_prost"]<- CutQ(cancer_2.2[,8], breaks = 6, na.rm =FALSE)
```

```{r EDA}
##not sure if apriori would work with this data, haven't figured it out yet
#when I had results none were pertaining to geography

geo<- list(cancer_2.3$GEO)

#assco_rules<- apriori(cancer_2.3, parameter = list(supp = 0.01, conf = 0.05), appearance = list(lhs=geo))
#summary(assco_rules)
#inspect(assco_rules)
```

```{r GEO split}
#######SPLIT NEW TABLE INTO GEOGRAPHIC REGIONS
##with quantiles
cancer_ON.3<- cancer_2.3[grep("Ontario", cancer_2.3$GEO),]

cancer_QC.3<- cancer_2.3[grep("Quebec", cancer_2.3$GEO),]
cancer_BC.3<- cancer_2.3[grep("British Columbia", cancer_2.3$GEO),]

cancer_MB.3<- cancer_2.3[grep("Manitoba", cancer_2.3$GEO),]
cancer_SK.3<- cancer_2.3[grep("Saskatchewan", cancer_2.3$GEO),]
cancer_AB.3<- cancer_2.3[grep("Alberta", cancer_2.3$GEO),]
cancer_midwest.3<- rbind(cancer_MB.3,cancer_AB.3,cancer_SK.3)

cancer_NL.3<- cancer_2.3[grep("Newfoundland", cancer_2.3$GEO),]
cancer_NB.3<- cancer_2.3[grep("New Brunswick", cancer_2.3$GEO),]
cancer_NS.3<- cancer_2.3[grep("Nova Scotia", cancer_2.3$GEO),]
cancer_PEI.3<- cancer_2.3[grep("Prince Edward Island",cancer_2.3$GEO),]
cancer_maritimes.3<- rbind(cancer_NS.3,cancer_NB.3,cancer_NL.3,cancer_PEI.3)

cancer_YT.3<- cancer_2.3[grep("Yukon", cancer_2.3$GEO),]
cancer_NWT.3<-cancer_2.3[grep("Northwest Territories", cancer_2.3$GEO),]
cancer_NVT.3<-cancer_2.3[grep("Nunavut", cancer_2.3$GEO),]
cancer_territories.3<- rbind(cancer_NWT.3,cancer_YT.3,cancer_NVT.3)


##continuous
cancer_ON.2<- cancer_2.2[grep("Ontario", cancer_2.2$GEO),]
cancer_QC.2<- cancer_2.2[grep("Quebec", cancer_2.2$GEO),]
cancer_BC.2<- cancer_2.2[grep("British Columbia", cancer_2.2$GEO),]

cancer_MB.2<- cancer_2.2[grep("Manitoba", cancer_2.2$GEO),]
cancer_SK.2<- cancer_2.2[grep("Saskatchewan", cancer_2.2$GEO),]
cancer_AB.2<- cancer_2.2[grep("Alberta", cancer_2.2$GEO),]
cancer_midwest.2<- rbind(cancer_MB.2,cancer_AB.2,cancer_SK.2)

cancer_NL.2<- cancer_2.2[grep("Newfoundland", cancer_2.2$GEO),]
cancer_NB.2<- cancer_2.2[grep("New Brunswick", cancer_2.2$GEO),]
cancer_NS.2<- cancer_2.2[grep("Nova Scotia", cancer_2.2$GEO),]
cancer_PEI.2<- cancer_2.2[grep("Prince Edward Island",cancer_2.2$GEO),]
cancer_maritimes.2<- rbind(cancer_NS.2,cancer_NB.2,cancer_NL.2,cancer_PEI.2)

cancer_YT.2<- cancer_2.2[grep("Yukon", cancer_2.2$GEO),]
cancer_NWT.2<-cancer_2.2[grep("Northwest Territories", cancer_2.2$GEO),]
cancer_NVT.2<-cancer_2.2[grep("Nunavut", cancer_2.2$GEO),]
cancer_territories.2<- rbind(cancer_NWT.2,cancer_YT.2,cancer_NVT.2)


```{r preliminary time series analysis}
##try time series analysis
###Just a peek

ts_ON.2<-ts(data = cancer_ON.2, frequency = n_distinct(cancer_ON.2$GEO) ,start = 2001, end = 2015)
ts.plot(ts_ON.2)

ts_QC.2<-ts(data = cancer_QC.2, frequency = n_distinct(cancer_QC.2$GEO) ,start = 2001, end = 2015)
ts.plot(ts_QC.2)

ts_BC.2<-ts(data = cancer_BC.2, frequency = n_distinct(cancer_BC.2$GEO) ,start = 2001, end = 2015)
ts.plot(ts_BC.2)

ts_midwest.2<-ts(data = cancer_midwest.2, frequency = n_distinct(cancer_midwest.2$GEO) ,start = 2001, end = 2015)
ts.plot(ts_midwest.2)

ts_maritimes.2<-ts(data = cancer_maritimes.2,frequency = n_distinct(cancer_maritimes.2$GEO) , start = 2001, end = 2015)
ts.plot(ts_maritimes.2)

ts_territories.2<-ts(data = cancer_territories.2, frequency = n_distinct(cancer_maritimes.2$GEO) ,start = 2001, end = 2015)
ts.plot(ts_territories.2)
```

```{r preliminary time series analysis}
##All cancer

ts.plot(ts_ON.2[,4], main = "All sites of cancer")
ts.plot(ts_QC.2[,4], main = "All sites of cancer")
ts.plot(ts_BC.2[,4], main = "All sites of cancer")
ts.plot(ts_midwest.2[,4], main = "All sites of cancer")
ts.plot(ts_maritimes.2[,4], main = "All sites of cancer")
ts.plot(ts_territories.2[,4], main = "All sites of cancer")

#Lung

ts.plot(ts_ON.2[,5], main="Bronchus and lung cancer")
ts.plot(ts_QC.2[,5], main="Bronchus and lung cancer")
ts.plot(ts_BC.2[,5], main="Bronchus and lung cancer")
ts.plot(ts_midwest.2[,5], main="Bronchus and lung cancer")
ts.plot(ts_maritimes.2[,5], main="Bronchus and lung cancer")
ts.plot(ts_territories.2[,5], main="Bronchus and lung cancer")


#Colon

ts.plot(ts_ON.2[,6], main="Colon cancer")
ts.plot(ts_QC.2[,6], main="Colon cancer")
ts.plot(ts_BC.2[,6], main="Colon cancer")
ts.plot(ts_midwest.2[,6], main="Colon cancer")
ts.plot(ts_maritimes.2[,6], main="Colon cancer")
ts.plot(ts_territories.2[,6], main="Colon cancer")
```
```{r}
plot(decompose(ts_ON.2[,4]))
plot(decompose(ts_ON.2[,5]))
plot(decompose(ts_ON.2[,6]))
#plot(decompose(ts_ON.2[,7], na.action(na.pass)))
#plot(decompose(ts_ON.2[,8],na.action(na.pass)))

plot(decompose(ts_QC.2[,4]))
plot(decompose(ts_QC.2[,5]))
plot(decompose(ts_QC.2[,6]))

plot(decompose(ts_BC.2[,4]))
plot(decompose(ts_BC.2[,5]))
plot(decompose(ts_BC.2[,6]))

plot(decompose(ts_midwest.2[,4]))
plot(decompose(ts_midwest.2[,5]))
plot(decompose(ts_midwest.2[,6]))

plot(decompose(ts_maritimes.2[,4]))
plot(decompose(ts_maritimes.2[,5]))
plot(decompose(ts_maritimes.2[,6]))

plot(decompose(ts_territories.2[,4]))
plot(decompose(ts_territories.2[,5]))
plot(decompose(ts_territories.2[,6]))


```

```{r preliminary time series analysis-2}
###check ACF to determine what predictive model to use
#Ontario
acf(ts_ON.2[,4], type = "correlation")
acf(ts_ON.2[,4], type= "partial")
acf(ts_ON.2[,5], type = "correlation")
acf(ts_ON.2[,5], type= "partial")
acf(ts_ON.2[,6], type = "correlation")
acf(ts_ON.2[,6], type= "partial")

#Quebec
acf(ts_QC.2[,4], type = "correlation")
acf(ts_QC.2[,4], type= "partial")
acf(ts_QC.2[,5], type = "correlation")
acf(ts_QC.2[,5], type= "partial")
acf(ts_QC.2[,6], type = "correlation")
acf(ts_QC.2[,6], type= "partial")

#BRITISH COLUMBIA
acf(ts_BC.2[,4], type = "correlation")
acf(ts_BC.2[,4], type= "partial")
acf(ts_BC.2[,5], type = "correlation")
acf(ts_BC.2[,5], type= "partial")
acf(ts_BC.2[,6], type = "correlation")
acf(ts_BC.2[,6], type= "partial")

##MIDWEST
acf(ts_midwest.2[,4], type = "correlation")
acf(ts_midwest.2[,4], type= "partial")
acf(ts_midwest.2[,5], type = "correlation")
acf(ts_midwest.2[,5], type= "partial")
acf(ts_midwest.2[,6], type = "correlation")
acf(ts_midwest.2[,6], type= "partial")

#Maritimes
acf(ts_maritimes.2[,4], type = "correlation")
acf(ts_maritimes.2[,4], type= "partial")
acf(ts_maritimes.2[,5], type = "correlation")
acf(ts_maritimes.2[,5], type= "partial")
acf(ts_maritimes.2[,6], type = "correlation")
acf(ts_maritimes.2[,6], type= "partial")

#territories
acf(ts_territories.2[,4], type = "correlation")
acf(ts_territories.2[,4], type= "partial")
acf(ts_territories.2[,5], type = "correlation")
acf(ts_territories.2[,5], type= "partial")
acf(ts_territories.2[,6], type = "correlation")
acf(ts_territories.2[,6], type= "partial")

#####
###doesn't look like any of them are sufficiently stationary
##makes me want to use ARIMA
##time series regression
###see decomposition
```

